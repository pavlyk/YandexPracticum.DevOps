# Глава 3. Практическая работа 2

```console
Перед выполнением работы: зайдите в [бота](https://t.me/practicumDevOpsHelperBot), выберите Главу 3 и нажмите кнопку Прислать коммиты для «Права пользователей».
```

```console
Инструкция по сдаче домашних заданий: в качестве ответа на это практическое задание вам нужно отправить IP-адрес виртуальной машины наставнику. Кроме того, все задания нужно выполнять последовательно.
```

### **Задание 1**
1. Скачайте zip-архив с артефактами из GitLab Job своего репозитория.
2. Достаньте из архива jar-файл и положите на свою виртуальную машину вместо текущего в `/var/jarservice`.

```console
Подсказка: Прежде чем спрыгивать с поезда, его сначала нужно остановить.
```

3. С помощью lsof проверьте, остались ли в памяти удалённые файлы?
4. Сделайте так, чтобы jarservice был владельцем всех файлов и папок в папке `/var/jarservice`, а группа владельца была `jarusers`.
5. Замените в `sausage-store-backend.service` запуск приложения с запуска из-под суперадминистратора на запуск из-под пользователя `jarservice`. Проверьте, что бэкенд после смены пользователя запускается, а логи и отчеты могут записываться туде же, куда и раньше. Если не смогут, то дайте пользователю `jarservice` прав записывать в эти папки.
6. Оставьте бэкенд запущенным.


### **Задание 2**
1. Сделайте так, чтобы `front-user` был владельцем всех файлов и папок для фронтенда `/var/www-data/dist/frontend/`.
2. Создайте для запуска фронтенда сервис-файл `sausage-store-frontend.service`, который должен работать из-под пользователя `front-user`. Логи записывайте в `/logs/out-front.log`.
3. Запустите фронт и проверьте, что приложение работает. Купите парочку русских сосисок и получите +1 любви к отечественному производителю.


### **Задание 3**
1. Сделайте владельцем директории `/var/www-data/htdocs/` пользователя `jarservice` и группу `jarservice`. Установите на директорию **SGID** и права **775**. Попробуйте создать в директории файл `test-report.txt` под пользователем `root`.
2. При помощи **acl** установите по дефолту права на чтение и исполнение для пользователя `front-user` для новых файлов в директории `/var/www-data/htdocs`, чтобы созданные файлы были доступны пользователям веб-сервиса.


### **Бонусное задание 1**
1. Запишите в файл `/opt/bonus_right.txt` список команд, которые позволят создать 10 новых пользователей `alex0-alex9`, объединить их в новую группу `alex`, выдать им права на просмотр всех системных логов, не меняя их текущих владельцев и сохранять список всех расширенных прав в файл `/opt/saved_rights`.
2. Дополните файл `/opt/bonus_right.txt` командами, которые будут использовать неименованные каналы, чтобы записать в файл `/tmp/size_log.txt` информацию о размере всех лог-файлов бэкенда сосисочной, отсортированных от большего к меньшему.


### **Задание 4**
Проверьте на своей виртуальной машине, под каким пользователем работает и какой порт использует наше бэкенд приложение, и запишите в файл `/opt/java_application.txt` в формате: **user:1111**.


### **Задание 5**
1. Разрешите в **iptables** входящее подключение на порт **443** для интерфейса **eth0** и всех подсетей. Используйте протокол TCP.
2. Запретите в **iptables** входящее подключение на порт **8080** для интерфейса **eth0** и всех подсетей. Используйте протокол TCP.


### **Задание 6**
Добавьте пользователю `jarservice` свой публичный ключ и настройте доступ по ключу. Закройте ssh-доступ под пользователем root.


### **Задание 7**
1. Посмотрите на сервере, какой IP-адрес у используемого нами DNS-сервера, и запишите в файл `/opt/dns_server.txt`, в формате: `192.168.10.10`.
2. Посмотрите с сервера, в какой IPv4-адрес резолвится доменное имя `refactoring.guru`, и запишите в файл `/opt/resolv_server.txt` в формате (вообще без пробелов): `192.168.10.10,192.168.10.11,192.168.10.12`.


### **Задание 8**
Подмонтируйте директорию `/var/www/images`, находящуюся на машине `178.154.212.255`, локально в директорию `/mnt/images`, и не забудьте добавить монтирование в автозагрузку.


### **Бонусное задание 2**
Разверните у себя на виртуальной машине NFS-сервер, создайте правило, которое позволит другим студентам подмонтироваться к вашему NFS-серверу в папку `/mnt/pets` с правами за запись. Попросите других студентов подмонтироваться к вашему NFS-серверу и создать в вашей папке файл `<фамилия>.txt`, в который нужно записать имя их домашнего животного.
Например:
```console
$ cat erokhin.txt  
Pluha 
```
